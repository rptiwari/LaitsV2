package amt.gui.dialog;

import amt.Main;
import amt.graph.GraphCanvas;
import amt.log.Logger;
import java.awt.Frame;
import java.io.File;
import java.util.LinkedList;
import java.util.logging.Level;
import javax.swing.JDialog;
import metatutor.Query;

/**
 * Verifies whether the user wants to exit the program
 *
 * @author Megan Kearl
 * @version 20100331
 *
 */
public class ExitDialog extends JDialog {

  private Frame p;
//  private GraphCanvas gc;
  boolean closingSet = false;
//  boolean closing = false;
  private int Points;
  private static Logger logs = Logger.getLogger();

  /**
   * Creates new form ExitDialog Form
   */
  public ExitDialog(java.awt.Frame parent, boolean modal) {
    super(parent, modal);
    p = parent;
    this.setTitle("");
    initComponents();
    this.setLocationRelativeTo(parent);
    LinkedList<amt.gui.NodeEditor> openTabs = GraphCanvas.getOpenTabs();
    for (int i = 0; i < openTabs.size(); i++) {
      openTabs.get(i).setAlwaysOnTop(false);
    }
    openTabs.clear();
    this.pack();
  }

  public boolean closingSet() {
    return closingSet();
  }

  public void closing() {
    this.dispose();
    ClosingDialog cd = new ClosingDialog(p, false);
    cd.setVisible(true);
  }

  /**
   * This method is called from within the constructor to initialize the form.
   * WARNING: Do NOT modify this code. The content of this method is always
   * regenerated by the Form Editor.
   */
  @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        Panel = new javax.swing.JPanel();
        titleLabel = new javax.swing.JLabel();
        yesButton = new javax.swing.JButton();
        noButton = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setResizable(false);

        Panel.setBackground(new java.awt.Color(255, 255, 255));

        titleLabel.setFont(new java.awt.Font("Lucida Grande", 1, 13)); // NOI18N
        titleLabel.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        titleLabel.setText("Are you sure you would like to exit?");

        yesButton.setText("Yes");
        yesButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                yesButtonActionPerformed(evt);
            }
        });

        noButton.setText("No");
        noButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                noButtonActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout PanelLayout = new javax.swing.GroupLayout(Panel);
        Panel.setLayout(PanelLayout);
        PanelLayout.setHorizontalGroup(
            PanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(titleLabel, javax.swing.GroupLayout.DEFAULT_SIZE, 428, Short.MAX_VALUE)
            .addGroup(PanelLayout.createSequentialGroup()
                .addGap(115, 115, 115)
                .addComponent(yesButton)
                .addGap(42, 42, 42)
                .addComponent(noButton)
                .addContainerGap())
        );
        PanelLayout.setVerticalGroup(
            PanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(PanelLayout.createSequentialGroup()
                .addGap(32, 32, 32)
                .addComponent(titleLabel)
                .addGap(18, 18, 18)
                .addGroup(PanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(yesButton)
                    .addComponent(noButton))
                .addContainerGap(22, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(Panel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(Panel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

   private void yesButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_yesButtonActionPerformed
     File file = new File("user.dat");
     file.delete();

     logs.concatOut(Logger.ACTIVITY, "ExitDialog.yesButtonActionPerformed.1", "" + Points);

     logs.out(Logger.ACTIVITY, "Main.windowClosing.1");
     if (Main.MetaTutorIsOn)
        Query.getBlockQuery().listen("ENDING SESSION");
     try {
       Thread.sleep(1000);
     } catch (InterruptedException ex) {
       java.util.logging.Logger.getLogger(Main.class.getName()).log(Level.SEVERE, null, ex);
     }

     // closing();
     this.dispose();
     System.exit(0);

   }//GEN-LAST:event_yesButtonActionPerformed

   private void noButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_noButtonActionPerformed
     LinkedList<amt.gui.NodeEditor> openTabs = GraphCanvas.getOpenTabs();
     for (int i = 0; i < openTabs.size(); i++) {
       openTabs.get(i).setAlwaysOnTop(true);
     }
     openTabs.clear();
     this.dispose();
   }//GEN-LAST:event_noButtonActionPerformed
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel Panel;
    private javax.swing.JButton noButton;
    private javax.swing.JLabel titleLabel;
    private javax.swing.JButton yesButton;
    // End of variables declaration//GEN-END:variables
}
